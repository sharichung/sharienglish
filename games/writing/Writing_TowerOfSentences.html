<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ Word Builders: Tower of Sentences</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Baloo 2', cursive;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 50%, #ffd3a5 100%);
            min-height: 100%;
            overflow-x: hidden;
        }

        html, body {
            height: 100%;
        }

        .container {
            min-height: 100%;
            position: relative;
            padding: 20px;
        }

        .clouds {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50px;
            opacity: 0.6;
            animation: float 20s infinite linear;
        }

        .cloud:before {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50px;
        }

        .cloud1 {
            width: 80px;
            height: 40px;
            top: 20%;
            left: -100px;
            animation-duration: 25s;
        }

        .cloud1:before {
            width: 50px;
            height: 50px;
            top: -25px;
            left: 10px;
        }

        .cloud2 {
            width: 60px;
            height: 30px;
            top: 60%;
            left: -80px;
            animation-duration: 30s;
        }

        .cloud2:before {
            width: 40px;
            height: 40px;
            top: -20px;
            left: 15px;
        }

        @keyframes float {
            from { transform: translateX(-100px); }
            to { transform: translateX(calc(100vw + 100px)); }
        }

        .sparkles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        .sparkle {
            position: absolute;
            color: #ffd700;
            font-size: 12px;
            animation: sparkle 3s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .screen {
            display: none;
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
        }

        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .form-group {
            margin: 30px 0;
        }

        .form-group label {
            display: block;
            font-size: 1.2rem;
            color: #34495e;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .form-group input {
            padding: 15px 20px;
            font-size: 1.1rem;
            border: 3px solid #3498db;
            border-radius: 25px;
            width: 300px;
            max-width: 90%;
            font-family: 'Baloo 2', cursive;
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.3);
            transform: scale(1.05);
        }

        .avatar-selection {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .avatar.selected {
            border-color: #e74c3c;
            background: #fff;
            transform: scale(1.2);
        }

        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: 600;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            margin: 10px;
            font-family: 'Baloo 2', cursive;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .game-screen {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            height: calc(100vh - 40px);
        }

        .tower-area {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow-y: auto;
        }

        .tower {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100%;
            justify-content: flex-start;
            padding: 20px 0;
        }

        .tower-block {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border-radius: 15px;
            padding: 20px;
            margin: 5px 0;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transform: translateY(20px);
            opacity: 0;
            animation: blockAppear 0.8s ease forwards;
            position: relative;
            overflow: hidden;
        }

        .tower-block:nth-child(even) {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
        }

        .tower-block:nth-child(3n) {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
        }

        @keyframes blockAppear {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .tower-block.glow {
            animation: glow 1s ease-in-out;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
            50% { box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.4); }
        }

        .tower-foundation {
            background: linear-gradient(45deg, #8b4513, #a0522d);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 0;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            border: 3px solid #654321;
        }

        .foundation-text {
            font-size: 1.1rem;
            color: white;
            font-weight: 600;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .sentence-text {
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 600;
            line-height: 1.4;
        }

        .teacher-panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            height: fit-content;
        }

        .teacher-panel h3 {
            color: #2c3e50;
            margin-top: 0;
            font-size: 1.3rem;
        }

        .current-sentence {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .word-prompts {
            background: rgba(241, 196, 15, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border-left: 5px solid #f1c40f;
        }

        .word-prompts h4 {
            margin: 0 0 10px 0;
            color: #f39c12;
        }

        .word-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .word-tag {
            background: #f1c40f;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .word-tag:hover {
            background: #f39c12;
            transform: scale(1.05);
            border-color: #e67e22;
        }

        .word-info-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1001;
            max-width: 400px;
            width: 90%;
            display: none;
        }

        .word-info-popup.show {
            display: block;
            animation: popupAppear 0.3s ease;
        }

        @keyframes popupAppear {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
        }

        .popup-overlay.show {
            display: block;
        }

        .word-info-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .word-info-word {
            font-size: 2rem;
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .word-info-type {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-block;
        }

        .word-info-meaning {
            background: rgba(52, 152, 219, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
        }

        .word-info-example {
            background: rgba(46, 204, 113, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #2ecc71;
        }

        .word-info-example strong {
            color: #27ae60;
        }

        .close-popup-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-family: 'Baloo 2', cursive;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s ease;
        }

        .close-popup-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .student-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #3498db;
            border-radius: 10px;
            font-family: 'Baloo 2', cursive;
            font-size: 1rem;
            margin: 10px 0;
            resize: vertical;
            min-height: 80px;
        }

        .floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 100;
            display: none;
        }

        .floating-btn.show {
            display: block;
        }

        .floating-btn:hover {
            transform: scale(1.1);
        }

        .summary-screen {
            padding: 20px;
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }

        .celebration-header {
            margin-bottom: 40px;
        }

        .celebration-title {
            font-size: 3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: celebrationBounce 2s infinite;
        }

        @keyframes celebrationBounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-15px) scale(1.05); }
            60% { transform: translateY(-8px) scale(1.02); }
        }

        .player-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .player-avatar {
            font-size: 3rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .achievement-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .achievement-card h3 {
            color: #2c3e50;
            margin: 10px 0;
            font-size: 1.3rem;
        }

        .achievement-stat {
            color: #7f8c8d;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .final-tower-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin: 30px 0;
        }

        .final-tower-preview h3 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .mini-tower {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .mini-block {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border-radius: 10px;
            padding: 12px 20px;
            width: 80%;
            max-width: 300px;
            font-size: 0.9rem;
            color: #2c3e50;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .mini-block:nth-child(even) {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
        }

        .mini-block:nth-child(3n) {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
        }

        .summary-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .tts-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
            border-radius: 20px;
        }

        .message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .message.show {
            opacity: 1;
        }

        .message.success {
            background: #2ecc71;
            color: white;
        }

        .message.warning {
            background: #f39c12;
            color: white;
        }

        .message.info {
            background: #3498db;
            color: white;
        }

        .message.error {
            background: #e74c3c;
            color: white;
        }

        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f1c40f;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .game-screen {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }
            
            .teacher-panel {
                order: -1;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .form-group input {
                width: 250px;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        [aria-live] {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        .lesson-grid {
            display: grid;
            grid-template-columns: 1fr 320px; /* ‰∏ªÂÖßÂÆπ + ÂÅ¥Ê¨Ñ */
            gap: 16px;
            max-width: 1100px;
            margin: 0 auto;
            align-items: start;
        }
        @media (max-width: 800px) {
            .lesson-grid { grid-template-columns: 1fr; }
        }
        .input-card {
            background: #fff;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(20,20,40,0.06);
            overflow: hidden; /* Á¢∫‰øù‰∏çÊúÉÊ∫¢Âá∫ */
        }
        .student-input {
            width: 100%;
            min-height: 6rem;
            max-height: 40vh;
            resize: vertical;
            box-sizing: border-box;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            line-height: 1.4;
            background: #fff;
            display: block;
        }
    </style>
</head>
<body>
    <div class="clouds">
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
    </div>
    
    <div class="sparkles" id="sparkles"></div>
    
    <div class="container">
        <!-- Welcome Screen -->
        <div class="screen active" id="welcomeScreen">
            <div class="welcome-screen">
                <h1 class="title">üè∞ Word Builders: Tower of Sentences</h1>
                
                <div class="form-group">
                    <label for="studentName">What's your name?</label>
                    <input type="text" id="studentName" placeholder="Enter your name" aria-describedby="nameError">
                </div>
                
                <div class="form-group">
                    <label>Choose your avatar:</label>
                    <div class="avatar-selection" role="radiogroup" aria-label="Avatar selection">
                        <div class="avatar" data-avatar="ü¶∏" role="radio" tabindex="0" aria-label="Superhero">ü¶∏</div>
                        <div class="avatar" data-avatar="üßô" role="radio" tabindex="-1" aria-label="Wizard">üßô</div>
                        <div class="avatar" data-avatar="üê±" role="radio" tabindex="-1" aria-label="Cat">üê±</div>
                        <div class="avatar" data-avatar="ü¶Ñ" role="radio" tabindex="-1" aria-label="Unicorn">ü¶Ñ</div>
                        <div class="avatar" data-avatar="üê∏" role="radio" tabindex="-1" aria-label="Frog">üê∏</div>
                        <div class="avatar" data-avatar="ü¶ã" role="radio" tabindex="-1" aria-label="Butterfly">ü¶ã</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="startGame()">‚ú® Start Game</button>
                <button class="btn btn-secondary" onclick="showInstructions()">üìñ How to Play</button>
            </div>
        </div>

        <!-- Instructions Screen -->
        <div class="screen" id="instructionsScreen">
            <div class="welcome-screen">
                <button class="back-btn" onclick="showScreen('welcomeScreen')" aria-label="Back to welcome">‚Üê</button>
                
                <h1 class="title">üìñ How to Play</h1>
                
                <div style="max-width: 800px; margin: 0 auto; text-align: left;">
                    <div class="achievement-card" style="margin: 20px 0;">
                        <div class="achievement-icon">üéØ</div>
                        <h3>Your Mission</h3>
                        <p>Build a tower of amazing sentences! Start with simple sentences and make them more interesting by adding descriptive words.</p>
                    </div>
                    
                    <div class="achievement-card" style="margin: 20px 0;">
                        <div class="achievement-icon">üìù</div>
                        <h3>How It Works</h3>
                        <p><strong>1.</strong> You'll see a simple sentence like "The cat sits."<br>
                        <strong>2.</strong> Look at the target words provided (like "fluffy", "quietly", "on the mat")<br>
                        <strong>3.</strong> Create a new sentence using those words: "The fluffy cat sits quietly on the mat."<br>
                        <strong>4.</strong> Your sentence becomes a block in your tower!</p>
                    </div>
                    
                    <div class="achievement-card" style="margin: 20px 0;">
                        <div class="achievement-icon">üí°</div>
                        <h3>Learning Tips</h3>
                        <p>‚Ä¢ Click on any target word to learn what it means<br>
                        ‚Ä¢ Try to use all the target words in your sentence<br>
                        ‚Ä¢ Make your sentences creative and fun!<br>
                        ‚Ä¢ Listen to your tower being read aloud when you're done</p>
                    </div>
                    
                    <div class="achievement-card" style="margin: 20px 0;">
                        <div class="achievement-icon">üèÜ</div>
                        <h3>Goal</h3>
                        <p>Build the tallest, most creative tower of sentences you can! Each sentence you create makes your tower grow higher and shows off your amazing writing skills.</p>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="showScreen('welcomeScreen')">‚ú® Got It! Let's Play</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div class="screen" id="gameScreen">
            <div class="game-screen">
                <div class="tower-area">
                    <div class="tower" id="tower">
                        <div class="tower-foundation">
                            <div class="foundation-text">üèóÔ∏è Start building your sentence tower!</div>
                        </div>
                    </div>
                </div>
                
                <div class="teacher-panel">
                    <h3>üéì Teacher Dashboard</h3>
                    
                    <div class="current-sentence">
                        <h4>üìù Current Sentence:</h4>
                        <p id="baseSentence">The cat sits.</p>
                    </div>
                    
                    <div class="word-prompts">
                        <h4>üéØ Target Words:</h4>
                        <div class="word-tags" id="targetWords">
                            <span class="word-tag">fluffy</span>
                            <span class="word-tag">quietly</span>
                            <span class="word-tag">on the mat</span>
                        </div>
                    </div>
                    
                    <label for="studentInput" class="sr-only">Student's enriched sentence</label>
                    <textarea 
                        id="studentInput" 
                        class="student-input" 
                        placeholder="Type your enriched sentence here..."
                        aria-describedby="inputHelp"
                    ></textarea>
                    <div id="inputHelp" class="sr-only">Add the target words to make your sentence more interesting</div>
                    
                    <button class="btn btn-primary" onclick="confirmSentence()">‚úÖ Confirm Sentence</button>
                    <button class="btn btn-secondary" onclick="nextWord()">‚û°Ô∏è Next Word</button>
                    <button class="btn btn-secondary" onclick="endGame()">üèÅ End Game</button>
                </div>
            </div>
        </div>

        <!-- Game Summary Screen -->
        <div class="screen" id="summaryScreen">
            <div class="summary-screen">
                <div class="celebration-header">
                    <h1 class="celebration-title">üéâ Amazing Work!</h1>
                    <div class="player-info">
                        <span class="player-avatar" id="summaryAvatar">ü¶∏</span>
                        <h2 id="summaryPlayerName">Player</h2>
                    </div>
                </div>
                
                <div class="achievements-grid">
                    <div class="achievement-card">
                        <div class="achievement-icon">üèóÔ∏è</div>
                        <h3>Tower Builder</h3>
                        <p class="achievement-stat" id="sentenceCount">0 sentences created</p>
                    </div>
                    
                    <div class="achievement-card">
                        <div class="achievement-icon">üìö</div>
                        <h3>Word Master</h3>
                        <p class="achievement-stat" id="wordCount">0 words added</p>
                    </div>
                    
                    <div class="achievement-card">
                        <div class="achievement-icon">‚≠ê</div>
                        <h3>Creative Writer</h3>
                        <p class="achievement-stat" id="creativityScore">Excellent creativity!</p>
                    </div>
                </div>
                
                <div class="final-tower-preview">
                    <h3>üè∞ Your Final Tower</h3>
                    <div class="mini-tower" id="miniTower">
                        <!-- Mini tower blocks will be added here -->
                    </div>
                </div>
                
                <div class="summary-actions">
                    <button class="btn btn-primary" onclick="playAllSentences()">üîä Read My Tower</button>
                    <button class="btn btn-secondary" onclick="startNewGame()">üîÑ Play Again</button>
                    <button class="btn btn-secondary" onclick="backToGame()">‚Ü©Ô∏è Continue Playing</button>
                </div>
            </div>
        </div>
    </div>



    <!-- Message Container -->
    <div class="message" id="message" role="alert" aria-live="assertive"></div>

    <!-- Confetti Container -->
    <div class="confetti" id="confetti"></div>

    <!-- Screen Reader Announcements -->
    <div aria-live="assertive" aria-atomic="true" class="sr-only" id="announcements"></div>

    <!-- Word Info Popup -->
    <div class="popup-overlay" id="popupOverlay" onclick="closeWordInfo()"></div>
    <div class="word-info-popup" id="wordInfoPopup">
        <div class="word-info-header">
            <div class="word-info-word" id="popupWord">Word</div>
            <div class="word-info-type" id="popupType">Type</div>
        </div>
        <div class="word-info-meaning" id="popupMeaning">
            <strong>üìñ Meaning:</strong>
            <p id="popupMeaningText">Definition goes here</p>
        </div>
        <div class="word-info-example" id="popupExample">
            <strong>üí° Example:</strong>
            <p id="popupExampleText">Example sentence goes here</p>
        </div>
        <button class="close-popup-btn" onclick="closeWordInfo()">Got it! ‚ú®</button>
    </div>

    <script>
        // Game state
        let gameState = {
            playerName: '',
            avatar: 'ü¶∏',
            sentences: [],
            currentSentenceIndex: 0,
            isPlaying: false
        };

        // Sample sentences and words with definitions
        const lessonData = [
            {
                base: "The cat sits.",
                words: [
                    {
                        word: "fluffy",
                        type: "adjective",
                        meaning: "Soft and light, like a cloud or cotton",
                        example: "The fluffy kitten felt so soft when I petted it."
                    },
                    {
                        word: "quietly",
                        type: "adverb",
                        meaning: "Making very little noise, in a silent way",
                        example: "She walked quietly so she wouldn't wake the baby."
                    },
                    {
                        word: "on the mat",
                        type: "prepositional phrase",
                        meaning: "Shows where something is located",
                        example: "The dog sleeps on the mat by the door."
                    }
                ]
            },
            {
                base: "Birds fly.",
                words: [
                    {
                        word: "colorful",
                        type: "adjective",
                        meaning: "Having many bright colors, like a rainbow",
                        example: "The colorful parrot had red, blue, and yellow feathers."
                    },
                    {
                        word: "high",
                        type: "adverb",
                        meaning: "Far up in the air, towards the sky",
                        example: "The airplane flew high above the clouds."
                    },
                    {
                        word: "in the sky",
                        type: "prepositional phrase",
                        meaning: "Shows where something is - up above us",
                        example: "I saw a shooting star in the sky last night."
                    }
                ]
            },
            {
                base: "Children play.",
                words: [
                    {
                        word: "happy",
                        type: "adjective",
                        meaning: "Feeling good and joyful, with a smile",
                        example: "The happy children laughed and smiled all day."
                    },
                    {
                        word: "together",
                        type: "adverb",
                        meaning: "With each other, as a group",
                        example: "The friends worked together to build a sandcastle."
                    },
                    {
                        word: "in the park",
                        type: "prepositional phrase",
                        meaning: "Shows where something happens - at the park",
                        example: "We had a picnic in the park under the big tree."
                    }
                ]
            },
            {
                base: "The sun shines.",
                words: [
                    {
                        word: "bright",
                        type: "adjective",
                        meaning: "Giving off lots of light, not dark",
                        example: "The bright sun made me squint my eyes."
                    },
                    {
                        word: "warmly",
                        type: "adverb",
                        meaning: "In a way that gives heat and comfort",
                        example: "The fire burned warmly in the fireplace."
                    },
                    {
                        word: "through the clouds",
                        type: "prepositional phrase",
                        meaning: "Shows how something moves - passing between clouds",
                        example: "Sunlight peeked through the clouds after the rain."
                    }
                ]
            },
            {
                base: "Dogs run.",
                words: [
                    {
                        word: "playful",
                        type: "adjective",
                        meaning: "Wanting to play and have fun",
                        example: "The playful puppy chased its tail in circles."
                    },
                    {
                        word: "quickly",
                        type: "adverb",
                        meaning: "Moving very fast, with speed",
                        example: "The rabbit quickly hopped away when it saw us."
                    },
                    {
                        word: "across the field",
                        type: "prepositional phrase",
                        meaning: "Shows direction - from one side to the other",
                        example: "The horse galloped across the field to reach the barn."
                    }
                ]
            }
        ];

        // Initialize sparkles
        function createSparkles() {
            const sparklesContainer = document.getElementById('sparkles');
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.textContent = '‚ú®';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 3 + 's';
                sparklesContainer.appendChild(sparkle);
            }
        }

        // Avatar selection
        document.querySelectorAll('.avatar').forEach(avatar => {
            avatar.addEventListener('click', function() {
                document.querySelectorAll('.avatar').forEach(a => {
                    a.classList.remove('selected');
                    a.setAttribute('aria-checked', 'false');
                    a.tabIndex = -1;
                });
                this.classList.add('selected');
                this.setAttribute('aria-checked', 'true');
                this.tabIndex = 0;
                gameState.avatar = this.dataset.avatar;
            });

            avatar.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });

        // Initialize first avatar as selected
        document.querySelector('.avatar').classList.add('selected');
        document.querySelector('.avatar').setAttribute('aria-checked', 'true');

        function startGame() {
            const nameInput = document.getElementById('studentName');
            const name = nameInput ? nameInput.value.trim() : '';
            
            if (!name) {
                showMessage('‚ùå Please enter your name to start the game!', 'error');
                if (nameInput) {
                    nameInput.focus();
                    nameInput.style.borderColor = '#e74c3c';
                    setTimeout(() => {
                        nameInput.style.borderColor = '#3498db';
                    }, 2000);
                }
                return;
            }
            
            if (name.length < 2) {
                showMessage('‚ùå Please enter a name with at least 2 characters!', 'error');
                if (nameInput) {
                    nameInput.focus();
                    nameInput.select();
                }
                return;
            }
            
            try {
                gameState.playerName = name;
                loadSentences();
                showScreen('gameScreen');
                loadCurrentLesson();
                showMessage(`üéâ Welcome ${name}! Let's build amazing sentences!`, 'success');
                announce(`Welcome ${name}! Let's start building sentences.`);
            } catch (error) {
                console.error('Error starting game:', error);
                showMessage('‚ùå Oops! Something went wrong starting the game. Please try again.', 'error');
            }
        }

        function showInstructions() {
            try {
                showScreen('instructionsScreen');
                announce('Instructions screen opened. Learn how to play the game.');
            } catch (error) {
                console.error('Error showing instructions:', error);
                showMessage('üéØ Build amazing sentences by adding descriptive words! Your teacher will help guide you through each step.', 'info');
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function loadSentences() {
            const saved = localStorage.getItem('wordBuildersSentences');
            if (saved) {
                gameState.sentences = JSON.parse(saved);
            }
        }

        function saveSentences() {
            localStorage.setItem('wordBuildersSentences', JSON.stringify(gameState.sentences));
        }

        function loadCurrentLesson() {
            const lesson = lessonData[gameState.currentSentenceIndex % lessonData.length];
            document.getElementById('baseSentence').textContent = lesson.base;
            
            const wordsContainer = document.getElementById('targetWords');
            wordsContainer.innerHTML = '';
            lesson.words.forEach((wordData, index) => {
                const tag = document.createElement('span');
                tag.className = 'word-tag';
                tag.textContent = wordData.word;
                tag.onclick = () => showWordInfo(wordData);
                tag.setAttribute('aria-label', `Click to learn about ${wordData.word}`);
                tag.setAttribute('role', 'button');
                tag.setAttribute('tabindex', '0');
                
                // Add keyboard support
                tag.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        showWordInfo(wordData);
                    }
                });
                
                wordsContainer.appendChild(tag);
            });
            
            document.getElementById('studentInput').value = '';
            document.getElementById('studentInput').focus();
        }

        function confirmSentence() {
            const inputElement = document.getElementById('studentInput');
            const input = inputElement ? inputElement.value.trim() : '';
            
            if (!input) {
                showMessage('‚ùå Please write your enriched sentence first!', 'error');
                if (inputElement) {
                    inputElement.focus();
                    inputElement.style.borderColor = '#e74c3c';
                    setTimeout(() => {
                        inputElement.style.borderColor = '#3498db';
                    }, 2000);
                }
                return;
            }

            if (input.length < 5) {
                showMessage('‚ùå Please write a longer, more detailed sentence!', 'error');
                if (inputElement) {
                    inputElement.focus();
                    inputElement.select();
                }
                return;
            }

            try {
                const sentence = {
                    id: Date.now(),
                    text: input,
                    level: gameState.sentences.length + 1,
                    timestamp: new Date().toLocaleDateString()
                };

                gameState.sentences.push(sentence);
                saveSentences();
                
                addTowerBlock(sentence);
                createConfetti();
                
                const encouragements = [
                    'üéâ Fantastic sentence! Your tower is growing!',
                    '‚ú® Amazing work! That sentence sparkles!',
                    'üèÜ Excellent! You are becoming a word master!',
                    'üåü Brilliant sentence! Keep building!',
                    'üéØ Perfect! You hit the target beautifully!'
                ];
                
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                showMessage(randomEncouragement, 'success');
                announce(`Great job! Sentence added to your tower: ${input}`);
                
                // Move to next lesson
                gameState.currentSentenceIndex++;
                setTimeout(() => {
                    loadCurrentLesson();
                    showMessage('üìù Ready for your next sentence challenge!', 'info');
                }, 2000);
                
            } catch (error) {
                console.error('Error saving sentence:', error);
                showMessage('‚ùå Oops! Could not save your sentence. Please try again.', 'error');
            }
        }

        function nextWord() {
            gameState.currentSentenceIndex++;
            loadCurrentLesson();
            showMessage('üìù New sentence ready!', 'info');
        }

        function giveHint() {
            const lesson = lessonData[gameState.currentSentenceIndex % lessonData.length];
            const hints = [
                `Try adding "${lesson.words[0]}" to describe the subject.`,
                `Use "${lesson.words[1]}" to show how the action happens.`,
                `Add "${lesson.words[2]}" to tell us where or when.`
            ];
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            showMessage(`üí° Hint: ${randomHint}`, 'info');
        }

        function pauseGame() {
            showMessage('‚è∏Ô∏è Game paused. Click any button to continue.', 'info');
        }

        function addTowerBlock(sentence) {
            const tower = document.getElementById('tower');
            const block = document.createElement('div');
            block.className = 'tower-block glow';
            block.innerHTML = `
                <div class="sentence-text">${sentence.text}</div>
            `;
            
            // Add block at the top of the tower (prepend to make it grow upward)
            tower.insertBefore(block, tower.firstChild);
            
            // Trigger entrance animation
            setTimeout(() => {
                block.style.transform = 'translateY(0)';
                block.style.opacity = '1';
            }, 100);
            
            // Scroll to show new block at top
            setTimeout(() => {
                tower.scrollTop = 0;
            }, 200);
        }

        function endGame() {
            showScreen('summaryScreen');
            loadGameSummary();
            createConfetti();
            announce('Game completed! Celebrating your achievements.');
        }

        function backToGame() {
            showScreen('gameScreen');
        }

        function startNewGame() {
            // Create custom confirmation popup
            const confirmReset = confirm('üîÑ Start a new game?\n\nThis will:\n‚Ä¢ Clear your current tower\n‚Ä¢ Reset your progress\n‚Ä¢ Take you back to the beginning\n\nAre you sure you want to continue?');
            
            if (confirmReset) {
                try {
                    // Stop any ongoing audio
                    stopReading();
                    
                    // Reset game state
                    gameState.sentences = [];
                    gameState.currentSentenceIndex = 0;
                    gameState.playerName = '';
                    gameState.avatar = 'ü¶∏';
                    gameState.isPlaying = false;
                    
                    // Clear localStorage
                    localStorage.removeItem('wordBuildersSentences');
                    
                    // Reset welcome screen form
                    const nameInput = document.getElementById('studentName');
                    if (nameInput) {
                        nameInput.value = '';
                    }
                    
                    // Reset avatar selection
                    const avatars = document.querySelectorAll('.avatar');
                    avatars.forEach((avatar, index) => {
                        avatar.classList.remove('selected');
                        avatar.setAttribute('aria-checked', 'false');
                        avatar.tabIndex = index === 0 ? 0 : -1;
                    });
                    
                    // Select first avatar by default
                    const firstAvatar = document.querySelector('.avatar');
                    if (firstAvatar) {
                        firstAvatar.classList.add('selected');
                        firstAvatar.setAttribute('aria-checked', 'true');
                        gameState.avatar = firstAvatar.dataset.avatar;
                    }
                    
                    // Reset tower display
                    const tower = document.getElementById('tower');
                    if (tower) {
                        tower.innerHTML = `
                            <div class="tower-foundation">
                                <div class="foundation-text">üèóÔ∏è Start building your sentence tower!</div>
                            </div>
                        `;
                    }
                    
                    // Reset student input
                    const studentInput = document.getElementById('studentInput');
                    if (studentInput) {
                        studentInput.value = '';
                    }
                    
                    // Show welcome screen
                    showScreen('welcomeScreen');
                    
                    // Success message and focus
                    showMessage('üéâ New game started! Ready for a fresh adventure!', 'success');
                    announce('New game started successfully. Please enter your name and choose an avatar.');
                    
                    // Focus on name input after a short delay
                    setTimeout(() => {
                        if (nameInput) {
                            nameInput.focus();
                        }
                    }, 500);
                    
                } catch (error) {
                    console.error('Error starting new game:', error);
                    showMessage('‚ùå Oops! There was a problem starting a new game. Please try again.', 'error');
                }
            } else {
                showMessage('‚úÖ Game continues! Your tower is safe.', 'info');
            }
        }

        function showWordInfo(wordData) {
            document.getElementById('popupWord').textContent = wordData.word;
            document.getElementById('popupType').textContent = wordData.type;
            document.getElementById('popupMeaningText').textContent = wordData.meaning;
            document.getElementById('popupExampleText').innerHTML = wordData.example.replace(
                new RegExp(`\\b${wordData.word}\\b`, 'gi'), 
                `<strong>${wordData.word}</strong>`
            );
            
            document.getElementById('popupOverlay').classList.add('show');
            document.getElementById('wordInfoPopup').classList.add('show');
            
            announce(`Learning about ${wordData.word}: ${wordData.meaning}`);
        }

        function closeWordInfo() {
            document.getElementById('popupOverlay').classList.remove('show');
            document.getElementById('wordInfoPopup').classList.remove('show');
        }

        function loadGameSummary() {
            // Update player info
            document.getElementById('summaryAvatar').textContent = gameState.avatar;
            document.getElementById('summaryPlayerName').textContent = gameState.playerName;
            
            // Calculate stats
            const sentenceCount = gameState.sentences.length;
            const totalWords = gameState.sentences.reduce((total, sentence) => {
                return total + sentence.text.split(' ').length;
            }, 0);
            
            // Update achievement cards
            document.getElementById('sentenceCount').textContent = `${sentenceCount} sentences created`;
            document.getElementById('wordCount').textContent = `${totalWords} words written`;
            
            // Creative score based on sentence variety
            let creativityMessage = 'Great start!';
            if (sentenceCount >= 10) creativityMessage = 'Amazing creativity!';
            else if (sentenceCount >= 5) creativityMessage = 'Excellent work!';
            else if (sentenceCount >= 3) creativityMessage = 'Good progress!';
            
            document.getElementById('creativityScore').textContent = creativityMessage;
            
            // Load mini tower
            const miniTower = document.getElementById('miniTower');
            miniTower.innerHTML = '';
            
            if (gameState.sentences.length === 0) {
                miniTower.innerHTML = '<p style="color: #7f8c8d;">No sentences created yet</p>';
                return;
            }
            
            gameState.sentences.forEach(sentence => {
                const miniBlock = document.createElement('div');
                miniBlock.className = 'mini-block';
                miniBlock.textContent = sentence.text;
                miniTower.appendChild(miniBlock);
            });
        }

        function readSentence(index) {
            if ('speechSynthesis' in window) {
                stopReading();
                const sentence = gameState.sentences[index];
                const utterance = new SpeechSynthesisUtterance(sentence.text);
                utterance.rate = 0.8;
                utterance.pitch = 1.1;
                
                utterance.onstart = () => {
                    gameState.isPlaying = true;
                    announce('Reading started.');
                };
                
                utterance.onend = () => {
                    gameState.isPlaying = false;
                    announce('Reading complete.');
                };
                
                speechSynthesis.speak(utterance);
            } else {
                showMessage('üîä Text-to-speech not supported in this browser.', 'warning');
            }
        }

        function pauseReading() {
            if (speechSynthesis.speaking && !speechSynthesis.paused) {
                speechSynthesis.pause();
                announce('Reading paused.');
            } else if (speechSynthesis.paused) {
                speechSynthesis.resume();
                announce('Reading resumed.');
            }
        }

        function stopReading() {
            speechSynthesis.cancel();
            gameState.isPlaying = false;
            announce('Reading stopped.');
        }

        function playAllSentences() {
            if (gameState.sentences.length === 0) {
                showMessage('‚ùå Your tower is empty! Create some sentences first.', 'error');
                return;
            }
            
            if (!('speechSynthesis' in window)) {
                showMessage('‚ùå Sorry! Audio reading is not supported in this browser.', 'error');
                return;
            }
            
            try {
                stopReading();
                showMessage('üîä Reading your amazing tower! Listen carefully...', 'info');
                
                let currentIndex = 0;
                
                function playNext() {
                    if (currentIndex < gameState.sentences.length) {
                        const sentence = gameState.sentences[currentIndex];
                        const utterance = new SpeechSynthesisUtterance(sentence.text);
                        utterance.rate = 0.8;
                        utterance.pitch = 1.1;
                        
                        utterance.onstart = () => {
                            announce(`Reading sentence ${currentIndex + 1}: ${sentence.text}`);
                        };
                        
                        utterance.onend = () => {
                            currentIndex++;
                            if (currentIndex < gameState.sentences.length) {
                                setTimeout(playNext, 500);
                            } else {
                                showMessage('üéâ Finished reading your entire tower! Great work!', 'success');
                                announce('All sentences read successfully.');
                            }
                        };
                        
                        utterance.onerror = () => {
                            showMessage('‚ùå Oops! There was a problem reading that sentence.', 'error');
                            currentIndex++;
                            setTimeout(playNext, 500);
                        };
                        
                        speechSynthesis.speak(utterance);
                    }
                }
                
                playNext();
                announce('Starting to read all sentences.');
                
            } catch (error) {
                console.error('Error playing sentences:', error);
                showMessage('‚ùå Sorry! Could not read your sentences. Please try again.', 'error');
            }
        }

        function stopAllAudio() {
            stopReading();
        }



        function showMessage(text, type = 'info') {
            const message = document.getElementById('message');
            message.textContent = text;
            message.className = `message ${type} show`;
            
            setTimeout(() => {
                message.classList.remove('show');
            }, 4000);
        }

        function announce(text) {
            const announcements = document.getElementById('announcements');
            announcements.textContent = text;
        }

        function createConfetti() {
            const confettiContainer = document.getElementById('confetti');
            const colors = ['#f1c40f', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6', '#e67e22'];
            
            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                piece.style.animationDelay = Math.random() * 2 + 's';
                confettiContainer.appendChild(piece);
                
                setTimeout(() => {
                    piece.remove();
                }, 3000);
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                stopReading();
                closeWordInfo();
            }
        });

        // Initialize
        createSparkles();
        loadSentences();

        // Load existing tower blocks if any
        function loadExistingTower() {
            if (gameState.sentences.length > 0) {
                // Clear any existing blocks first
                const tower = document.getElementById('tower');
                const blocks = tower.querySelectorAll('.tower-block');
                blocks.forEach(block => block.remove());
                
                // Add each sentence as a tower block
                gameState.sentences.forEach(sentence => {
                    addTowerBlock(sentence);
                });
            }
        }
        
        // Initialize tower when game starts
        loadExistingTower();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98d9744bb47ddb2e',t:'MTc2MDMwMjA2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
